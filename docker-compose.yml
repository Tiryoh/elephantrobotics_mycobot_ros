version: '3.4'

x-app: &common
  command: [ "roslaunch mycobot_ros mycobot_simple_gui.launch" ]
  privileged: true
  runtime: nvidia
  environment:
    PYTHONUNBUFFERED: 1
    QT_X11_NO_MITSHM: 1
    DISPLAY: :1
    NVIDIA_VISIBLE_DEVICES: all
    NVIDIA_DRIVER_CAPABILITIES: all
  volumes:
    - "/tmp/.X11-unix:/tmp/.X11-unix:rw"
  build:
    context: .
    args: &common-args
      ROS_DISTRO: "melodic"
      PYMYCOBOT_VERSION: ">=2<3"
      BASE_IMAGE: nvidia/opengl:1.1-glvnd-runtime-ubuntu18.04


services:
  # This configuration builds the project for computers with NVIDIA hardware
  nvidia-ros: *common

  # This is the default for computers that don't have nvidia hardware accelerators
  ros:
    <<: *common
    build:
      context: .
      args:
        <<: *common-args
        BASE_IMAGE: ubuntu:18.04
